$schema: 'https://moonrepo.dev/schemas/project.json'

language: typescript
layer: application

tasks:
  dev:
    command: next dev
    options:
      cache: false
      persistent: true

  build:
    command: next build
    inputs:
      - "src/**/*"
      - "public/**/*"
      - "next.config.ts"
      - "tailwind.config.ts"
    outputs:
      - ".next"

  start:
    command: next start
    options:
      cache: false
      persistent: true

  lint:
    command: eslint
    inputs:
      - "src/**/*"
      - "eslint.config.mjs"

  typecheck:
    command: tsc --noEmit
    inputs:
      - "src/**/*"
      - "tsconfig.json"

  generate:
    command: pnpm openapi-ts
    inputs:
      - "openapi-ts.config.ts"
      - "/packages/protocol/tsp-output/openapi/openapi.yaml"
    outputs:
      - "src/api/generated"

  test:
    command: pnpm vitest run
    inputs:
      - "src/**/*"
      - "vitest.config.ts"

  test-integration:
    command: pnpm vitest run --config vitest.integration.config.ts
    options:
      cache: false
      persistent: false

  test-e2e:
    command: pnpm playwright test
    options:
      cache: false
      persistent: false
